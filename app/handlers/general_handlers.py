"""
–ú–æ–¥—É–ª—å –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –∑–∞–≥–∞–ª—å–Ω–∏—Ö –∫–æ–º–∞–Ω–¥ —Ç–∞ –ø–æ–¥—ñ–π, —Ç–∞–∫–∏—Ö —è–∫ /start, /help,
–∞ —Ç–∞–∫–æ–∂ –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–æ—ó –æ–±—Ä–æ–±–∫–∏ –ø–æ–º–∏–ª–æ–∫.
"""
import logging
from aiogram import Dispatcher, types, Router
from aiogram.filters import CommandStart, Command
from aiogram.fsm.context import FSMContext
from aiogram.types import Message, Update
from aiogram.exceptions import TelegramBadRequest

# –°—Ç–≤–æ—Ä—é—î–º–æ —Ä–æ—É—Ç–µ—Ä –¥–ª—è –∑–∞–≥–∞–ª—å–Ω–∏—Ö –æ–±—Ä–æ–±–Ω–∏–∫—ñ–≤.
# –¶–µ –¥–æ–∑–≤–æ–ª—è—î –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –º–æ–¥—É–ª—å–Ω–æ—é —Ç–∞ —á–∏—Å—Ç–æ—é.
general_router = Router(name="general_router")

@general_router.message(CommandStart())
async def cmd_start(message: Message, state: FSMContext):
    """
    –û–±—Ä–æ–±–Ω–∏–∫ –∫–æ–º–∞–Ω–¥–∏ /start.

    –í—ñ—Ç–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —Å–∫–∏–¥–∞—î –π–æ–≥–æ —Å—Ç–∞–Ω (FSM) –Ω–∞ –≤–∏–ø–∞–¥–æ–∫,
    —è–∫—â–æ –≤—ñ–Ω –±—É–≤ —É —è–∫–æ–º—É—Å—å –¥—ñ–∞–ª–æ–∑—ñ, —Ç–∞ –Ω–∞–¥–∞—î –∫–æ—Ä–æ—Ç–∫—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é.
    """
    await state.clear()
    welcome_text = (
        "<b>–í—ñ—Ç–∞—é! –Ø GGenius, –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π MLBB-–∞–Ω–∞–ª—ñ—Ç–∏–∫.</b>\n\n"
        "–Ø —Ç—É—Ç, —â–æ–± –¥–æ–ø–æ–º–æ–≥—Ç–∏ –≤–∞–º —Ä–æ–∑–±–∏—Ä–∞—Ç–∏ –º–∞—Ç—á—ñ, –∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó —Ç–∞ –ø–æ–∫—Ä–∞—â—É–≤–∞—Ç–∏ –≤–∞—à—É –≥—Ä—É.\n\n"
        "üéÆ <b>–©–æ —è –≤–º—ñ—é:</b>\n"
        "  ‚Ä¢ <b>–ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Å–∫—Ä—ñ–Ω—à–æ—Ç–∏:</b> –ù–∞–¥—ñ—à–ª—ñ—Ç—å –º–µ–Ω—ñ —Å–∫—Ä—ñ–Ω—à–æ—Ç –ø—ñ—Å–ª—è–º–∞—Ç—á–µ–≤–æ—ó —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏, —ñ —è –∑—Ä–æ–±–ª—é –¥–µ—Ç–∞–ª—å–Ω–∏–π —Ä–æ–∑–±—ñ—Ä.\n"
        "  ‚Ä¢ <b>–í—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏ –Ω–∞ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è:</b> –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É <code>/gemini</code> –∞–±–æ –ø—Ä–æ—Å—Ç–æ –∑–≥–∞–¥–∞–π—Ç–µ –º–µ–Ω–µ –≤ —á–∞—Ç—ñ, —â–æ–± –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è.\n\n"
        "–î–ª—è —Å–ø–∏—Å–∫—É –≤—Å—ñ—Ö –∫–æ–º–∞–Ω–¥, –≤–≤–µ–¥—ñ—Ç—å /help."
    )
    await message.answer(welcome_text)


@general_router.message(Command(commands=["help"]))
async def cmd_help(message: Message):
    """
    –û–±—Ä–æ–±–Ω–∏–∫ –∫–æ–º–∞–Ω–¥–∏ /help.

    –ù–∞–¥–∞—î —Ä–æ–∑—à–∏—Ä–µ–Ω—É –¥–æ–≤—ñ–¥–∫—É —â–æ–¥–æ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª–∞ –±–æ—Ç–∞.
    """
    help_text = (
        "<b>–î–æ–≤—ñ–¥–∫–∞ –ø–æ —Ñ—É–Ω–∫—Ü—ñ—è—Ö GGenius:</b>\n\n"
        "<b>–ê–Ω–∞–ª—ñ–∑ –∑–æ–±—Ä–∞–∂–µ–Ω—å (Vision):</b>\n"
        "–ü—Ä–æ—Å—Ç–æ –Ω–∞–¥—ñ—à–ª—ñ—Ç—å –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è (—Å–∫—Ä—ñ–Ω—à–æ—Ç) —É —á–∞—Ç. –î–ª—è –Ω–∞–π–∫—Ä–∞—â–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É, –¥–æ–¥–∞–π—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤–∏–π –ø—ñ–¥–ø–∏—Å —ñ–∑ –≤–∞—à–∏–º –∑–∞–ø–∏—Ç–∞–Ω–Ω—è–º. –ù–∞–ø—Ä–∏–∫–ª–∞–¥: <i>\"–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π –º—ñ–π –±—ñ–ª–¥ —Ç–∞ –∑–∞–ø—Ä–æ–ø–æ–Ω—É–π –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è.\"</i>\n\n"
        "<b>–ü—Ä—è–º–∞ –≤–∑–∞—î–º–æ–¥—ñ—è –∑ Gemini AI:</b>\n"
        "  ‚Ä¢ <b>–ö–æ–º–∞–Ω–¥–∞ <code>/gemini</code>:</b> –ü–æ—á–Ω—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ —Ü—ñ—î—ó –∫–æ–º–∞–Ω–¥–∏, —â–æ–± –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ –±—É–¥—å-—è–∫–µ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è. –ù–∞–ø—Ä–∏–∫–ª–∞–¥: <code>/gemini —è–∫–∞ –∑–∞—Ä–∞–∑ –º–µ—Ç–∞ –¥–ª—è —Ä–æ—É–º–µ—Ä—ñ–≤?</code>\n"
        "  ‚Ä¢ <b>–¢—Ä–∏–≥–µ—Ä–Ω—ñ —Å–ª–æ–≤–∞:</b> –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç—å, —è–∫—â–æ –≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—ñ —î —Å–ª–æ–≤–∞ 'gemini' –∞–±–æ '–¥–∂–µ–º—ñ–Ω—ñ'.\n"
        "  ‚Ä¢ <b>–ù–æ–≤–∏–π –¥—ñ–∞–ª–æ–≥:</b> –ö–æ–º–∞–Ω–¥–∞ <code>/newchat</code> —Å–∫–∏–¥–∞—î —ñ—Å—Ç–æ—Ä—ñ—é –≤–∞—à–æ–≥–æ –¥—ñ–∞–ª–æ–≥—É, —â–æ –∫–æ—Ä–∏—Å–Ω–æ, –∫–æ–ª–∏ –≤–∏ —Ö–æ—á–µ—Ç–µ –æ–±–≥–æ–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É —Ç–µ–º—É.\n\n"
        "–ó–≤–µ—Ä—Ç–∞–π—Ç–µ—Å—è –∑ –±—É–¥—å-—è–∫–∏–º–∏ –ø–∏—Ç–∞–Ω–Ω—è–º–∏ —â–æ–¥–æ Mobile Legends!"
    )
    await message.answer(help_text)


async def cmd_go(message: types.Message, state: FSMContext):
    """
    –ü—Ä–∏–∫–ª–∞–¥ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ñ—É–Ω–∫—Ü—ñ—ó `cmd_go`, —è–∫–∞ –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –≤ —ñ–Ω—à—ñ –æ–±—Ä–æ–±–Ω–∏–∫–∏.
    –á—ó –º–æ–∂–Ω–∞ —Ä–æ–∑—à–∏—Ä–∏—Ç–∏ –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏—Ö –¥—ñ–π.
    """
    # –¶—è —Ñ—É–Ω–∫—Ü—ñ—è –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è —è–∫ –∞—Ä–≥—É–º–µ–Ω—Ç, —Ç–æ–º—É —ó—ó —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ –≤–∞–∂–ª–∏–≤–∞.
    # –õ–æ–≥—ñ–∫–∞ –º–æ–∂–µ –±—É—Ç–∏ –±—É–¥—å-—è–∫–æ—é, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∑–∞–ø—É—Å–∫ –ø–µ–≤–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä—ñ—é FSM.
    logger.info(f"–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {message.from_user.id} –≤–∏–∫–ª–∏–∫–∞–≤ –¥—ñ—é 'go'.")
    await message.reply("–î—ñ—è 'go' –≤ –æ–±—Ä–æ–±—Ü—ñ...")


async def error_handler(update: Update, exception: Exception, bot: types.Bot):
    """
    –¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –æ–±—Ä–æ–±–Ω–∏–∫ –ø–æ–º–∏–ª–æ–∫.

    –õ–æ–≥—É—î –≤—Å—ñ –≤–∏–Ω—è—Ç–∫–∏ —Ç–∞ —Å–ø–æ–≤—ñ—â–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º—É.
    –¶–µ –¥–æ–ø–æ–º–∞–≥–∞—î —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ–≤–Ω–æ–≥–æ –ø–∞–¥—ñ–Ω–Ω—è –±–æ—Ç–∞ —á–µ—Ä–µ–∑ –ø–æ–º–∏–ª–∫—É –≤ –æ–¥–Ω–æ–º—É –∑ –æ–±—Ä–æ–±–Ω–∏–∫—ñ–≤.
    """
    logger.error(f"–í–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ–±—Ä–æ–±—Ü—ñ update: {exception}", exc_info=True)

    error_message = (
        "üî¥ <b>–û–π, —â–æ—Å—å –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫...</b>\n\n"
        "–°—Ç–∞–ª–∞—Å—è –Ω–µ–ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–∞ –ø–æ–º–∏–ª–∫–∞. –Ø –≤–∂–µ –Ω–∞–¥—ñ—Å–ª–∞–≤ –∑–≤—ñ—Ç —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞–º.\n"
        "–°–ø—Ä–æ–±—É–π—Ç–µ, –±—É–¥—å –ª–∞—Å–∫–∞, –ø–æ–≤—Ç–æ—Ä–∏—Ç–∏ —Å–≤—ñ–π –∑–∞–ø–∏—Ç —Ç—Ä–æ—Ö–∏ –ø—ñ–∑–Ω—ñ—à–µ."
    )

    # –ù–∞–º–∞–≥–∞—î–º–æ—Å—å –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É, —è–∫—â–æ —Ü–µ –º–æ–∂–ª–∏–≤–æ
    if update.message:
        try:
            await update.message.answer(error_message)
        except Exception as e:
            logger.error(f"–ù–µ –≤–¥–∞–ª–æ—Å—è –Ω–∞–≤—ñ—Ç—å –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É: {e}")

    return True


def register_general_handlers(dp: Dispatcher):
    """
    –†–µ—î—Å—Ç—Ä—É—î —Ä–æ—É—Ç–µ—Ä —ñ–∑ –∑–∞–≥–∞–ª—å–Ω–∏–º–∏ –æ–±—Ä–æ–±–Ω–∏–∫–∞–º–∏ —É –≥–æ–ª–æ–≤–Ω–æ–º—É –¥–∏—Å–ø–µ—Ç—á–µ—Ä—ñ.
    """
    dp.include_router(general_router)
    # –ì–ª–æ–±–∞–ª—å–Ω–∏–π –æ–±—Ä–æ–±–Ω–∏–∫ –ø–æ–º–∏–ª–æ–∫ —Ä–µ—î—Å—Ç—Ä—É—î—Ç—å—Å—è –≤ main.py, —â–æ —î –≥–∞—Ä–Ω–æ—é –ø—Ä–∞–∫—Ç–∏–∫–æ—é.
    # dp.errors.register(error_handler)
